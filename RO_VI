Exercício 1 — Erro Lógico

BEGIN;
UPDATE contas SET saldo = saldo - 100 WHERE id = 1;
UPDATE contas SET saldo = saldo + 100 WHERE id = 2;
INSERT INTO contas (id, saldo) VALUES (1, 500);
COMMIT;

O INSERT gera uma violação de chave primária, causando um erro lógico.
Nenhum UPDATE é realmente aplicado ao banco de dados.

Nenhuma alteração nas contas.
Os saldos permanecem exatamente como antes do BEGIN.

Atomicidade: ou todos os comandos da transação são aplicados, ou nenhum é.
O erro lógico provoca rollback automático da transação.


Exercício 2 — Falha de Sistema

BEGIN;
UPDATE contas SET saldo = saldo - 200 WHERE id = 1;
UPDATE contas SET saldo = saldo + 200 WHERE id = 2;

net stop postgresql-x64-15
net start postgresql-x64-15

Como o COMMIT não foi executado, as alterações estavam somente na memória (buffers).

Ao reiniciar, o PostgreSQL usa o WAL (Write-Ahead Log) para restaurar o estado do banco:
UNDO: desfaz transações não confirmadas.
REDO: refaz apenas as confirmadas antes da queda.

Falha de Sistema: queda de energia, travamento do SO ou encerramento abrupto do processo.
WAL garante durabilidade e recuperação automática.
UNDO/REDO são os mecanismos de correção.


Exercício 3 — Falha de Comunicação

BEGIN;
UPDATE contas SET saldo = saldo - 50 WHERE id = 1;
UPDATE contas SET saldo = saldo + 50 WHERE id = 2;

A conexão entre o cliente e o servidor foi interrompida antes do COMMIT.
Nada muda nas tabelas, a transação é automaticamente rollbackada quando a sessão encerra.

Falha de Comunicação: perda de conexão entre cliente e servidor.
Recuperação: o servidor cancela a transação não finalizada.
Mantém a atomicidade e consistência dos dados.


Exercício 4 — Questão Teórica
Explique a diferença entre falha de sistema e falha de mídia. Por que a segunda é mais crítica?

Tipo de Falha	Descrição	Impacto	Recuperação
Falha de Sistema	Interrupção do processo do PostgreSQL ou do sistema operacional (queda de energia, travamento).	Perda dos dados em memória, mas o disco permanece íntegro.	O PostgreSQL usa o WAL para desfazer (UNDO) transações não confirmadas e refazer (REDO) as confirmadas.
Falha de Mídia (Disco)	Problemas físicos no armazenamento, como HD queimado ou setor corrompido.	Perda permanente dos dados em disco, incluindo logs.	É necessário restaurar um backup e reaplicar logs (WAL) gerados após o backup.

Por que a falha de mídia é mais crítica:
Porque pode haver perda total dos dados, inclusive dos arquivos de log.
A recuperação depende de backups externos, o que torna o processo mais demorado.
Enquanto a falha de sistema é temporária, a de mídia pode ser irreversível sem cópias de segurança.
